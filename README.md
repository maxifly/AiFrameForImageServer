# AiFrameForImageServer

Фоторамка, меняющая изображения через сервер изображений.

Сделана на основе оригинального проекта ["Фоторамка с нейросетью"](https://github.com/AlexGyver/AiFrame) Гайвера.
Так же были использованы решения, предложенные в обсуждении оригинального проекта.
За что я хотел бы выразить благодарность.

Работает в паре с [ImageServer](https://github.com/maxifly/ImageServer?tab=readme-ov-file). 

## Принцип работы
Рамка лишь запрашивает изображения у сервера. Сервер получает изображения от внешних ресурсов, 
обрабатывает и отдаёт рамке. Так же он хранит пул изображений и не каждый запрос отправляет вовне.
Это позволяет немного сэкономить на использовании платных ресурсов и при этом обеспечить частую ротацию изображений.
Кроме того, сервер через унификацированный интерфейс позволяет:
* хранить несколько промптов и выбирать для генерации один из них случайным образом
* подключить несколько внешних источников изображений и по запросу выбирать одного из них случайным образом

Предполагается, что сервер с рамкой общается внутри домашней сети, поэтому реализовано соединение по HTTP (а не по HTTPS).
(в планах - переделать)

## Особенности прошивки
### Настройки соединения с ImageServer
Необходимо указать IP сервера и порт по которому будет производится соединение.

### Промпт 
Временно закрыт ввод негативного промпта
Отсутвует выбор стиля

### Кнопки

Их несколько вместо одной

* ***"Поменять"*** - запрос нового изображения (сервер сам выбирает откуда)
* ***"Генерация"*** - запрос нового изображения (сервер в обязательном порядке запрашивает из внешнего источника)
* ***"По промпту"*** - запрос по промпту, введённом в интерфейс рамки (сервер в обязательном порядке запрашивает из внешнего источника)
* ***"Добавить промпт на сервер"*** - промпт введёный в интерфейс рамки сохраняется в пул промптов на сервере

### Обработка изображений
При получении изображения из него вырезается центральная область соответвующая размерам рамки. 
Это возможность показалась мне интересной. До использования сервера изображений я применял ее для обработки ответов от YandexArt, так как он не обеспечивал точный возврат изображения по заданным размерам в точках.
Сейчас эта возможность фактически отключена, так как сервер и так подгоняет изображение под размер рамки.

Вырезаемая область задаётся константами
```
// Константы, определяющие внутреннюю область
const int INTERNAL_X = 0;
const int INTERNAL_Y = 0;
const int INTERNAL_WIDTH = 320;
const int INTERNAL_HEIGHT = 480;
```
Указаны отступы по х и у и ширина и высота прямоугольника точек.

Кроме того, на моём экране изображение выводилось в негативе и в обработку пришлось добавить инверсию цветов (возможно это решается настройками, но я не нашёл).

### OTA
Я отключил изменения по OTA, так как не особо понимаю, что с этим делать (а пока "и так сойдёт" (с) ).

